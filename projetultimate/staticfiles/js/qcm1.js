/**
 * 
 */
var question = {
		"question1": {
			"enonce": "calculer 1", 
			"figure": "fig1.JPG",
			"choixMultiple" : "non",
			"propositions":{
				"propo1": {
					"enonce": "Résoudre dans Z l'équation : $x = x + x^2 + x^6 + x^3$.", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "l'équation est égale à $- 2 x^{6} - 3 x^{3} - 5$", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		}, 
		"question2": {
			"enonce": "calculer 2",
			"figure": "fig2.JPG", 
			"choixMultiple" : "oui",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "n", 
					"point" : 1, 
					"checked": "non"
				},
				"propo3": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		},
		"question3": {
			"enonce": "calculer 3",
			"figure": "fig2.JPG", 
			"choixMultiple" : "non",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		},
		"question4": {
			"enonce": "calculer 4",
			"figure": "", 
			"choixMultiple" : "non",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un $- 2 x^{6} - 3 x^{3} - 5$", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		}, 
		"question5": {
			"enonce": "calculer 5",
			"figure": "fig2.JPG", 
			"choixMultiple" : "oui",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo3": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		}, 
		"question6": {
			"enonce": "calculer 6",
			"figure": "fig2.JPG", 
			"choixMultiple" : "oui",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo3": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		}, 
		"question7": {
			"enonce": "calculer 7",
			"figure": "fig2.JPG", 
			"choixMultiple" : "oui",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo3": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		}, 
		"question8": {
			"enonce": "calculer 8",
			"figure": "fig2.JPG", 
			"choixMultiple" : "oui",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo3": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		}, 
		"question9": {
			"enonce": "calculer 9",
			"figure": "fig2.JPG", 
			"choixMultiple" : "oui",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo3": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				},
				"propo4": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		}, 
		"question10": {
			"enonce": "calculer 10",
			"figure": "fig2.JPG", 
			"choixMultiple" : "oui",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo3": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		},
		"question11": {
			"enonce": "calculer 11",
			"figure": "fig2.JPG", 
			"choixMultiple" : "oui",
			"propositions":{
				"propo1": {
					"enonce":"proposition 1 de 2 ceci est un blabla juste pour tester le responsive de mon site web ahahahah", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo2": {
					"enonce": "proposition 2 de 2", 
					"solution": "non", 
					"point" : 1, 
					"checked": "non"
				},
				"propo3": {
					"enonce": "proposition 2 de 2", 
					"solution": "oui", 
					"point" : 1, 
					"checked": "non"
				}
			}
		}
}; 
//url absolu pour les images
var my_url = "/home/leo/Bureau/projetultimate/projetultimate/staticfiles/img/qcm/"

//question courante
var numeroQuestionCourante = 1;

var nombreDeQuestion = Object.keys(question).length;

//question courante
var questionCourante = "question"+numeroQuestionCourante;

var listeQuestionsFaites = [];

//resultat 
var resultat = 0;

//fin du qcm
var finQcm = false;

$(document).ready(function() {
	
	var kids = $("#questionSet").children("div");
	var questionListe = {};
	for(var i=0; i<kids.length; i++){
		
		var kid1 = kids.eq(i).children("div");
		var numeroquestion = kid1.eq(0).text();
		
		var enonceQuestion = kid1.eq(1).text();
		var typeQuestion = kid1.eq(2).text();
		var figureQuestion = kid1.eq(3).text();
		
		var kids2 = kid1.eq(4).children("div");
		var propositionListe = {};
		
		for(var j=0; j<kids2.length; j++){
			var kids3 = kids2.eq(j).children("label");
			var numeroProposition = kids3.eq(0).text();
			var checkedProposition = kids3.eq(2).text();
			var enonceProposition = kids3.eq(4).text();
			var solutionProposition = kids3.eq(6).text();
			var pointProposition = kids3.eq(8).text();
			propositionListe[numeroProposition] = {
				"checked": checkedProposition,
				"enonce": enonceProposition,
				"solution": solutionProposition,
				"point": pointProposition
			}
		}
		questionListe[numeroquestion] = {
			"enonce": enonceQuestion, 
			"choixMultiple": typeQuestion, 
			"figure": figureQuestion, 
			"propositions": propositionListe
		}
	}
//	nombres de questions 
	question = questionListe;
	nombreDeQuestion = Object.keys(question).length;
	
	
	
	//debut du script
	$("#enonce").text(question[questionCourante].enonce);
	var radio_home = document.getElementById("proposition");
	for(key in question[questionCourante].propositions){
		if (question[questionCourante].choixMultiple == "non"){
			$("#proposition").append("<div class='radio icheck-primary' id ='class'"+key+"'> <input type='radio' id='"+key+"' name='propo' value ='"+question[questionCourante].propositions[key].solution+"'/> <label for='"+key+"'>"+question[questionCourante].propositions[key].enonce+"</label></div>");			
		} else{
			$("#proposition").append("<div class='checkbox icheck-primary' id ='class'"+key+"'> <input type='checkbox' id='"+key+"' name='propo' value ='"+question[questionCourante].propositions[key].solution+"'/> <label for='"+key+"'>"+question[questionCourante].propositions[key].enonce+"</label></div>");					
		}
	}
	for(var i=1; i<=nombreDeQuestion; i++){
		$("#ulQuestion").append("<li value='"+i+"' fait='non'><a href='#' id='ulQuestion"+i+"'>Question "+i+" sur "+nombreDeQuestion+"</a></li>");
	}

	//create img
	$("#image").attr('src', my_url+question[questionCourante].figure);

	//check button
	var ButtonVerifier = document.getElementById("check");
	ButtonVerifier.addEventListener ("click", function() {
		var propo = document.getElementsByName("propo");
		if(propo[0].type =='radio'){
			for(var i = 0; i < propo.length; i++) {
				if(propo[i].checked == true){
					if( propo[i].value=="oui") {
						propo[i].parentElement.setAttribute("class", "radio icheck-success");
						propo[i].parentElement.append(" Bonne réponse");
					}else{
						propo[i].parentElement.setAttribute("class", "radio icheck-danger");
						propo[i].parentElement.append(" Mauvaise réponse");
					}
					question[questionCourante].propositions[propo[i].id].checked = "oui";
				}else{
					question[questionCourante].propositions[propo[i].id].checked = "non";
				}
				propo[i].disabled = true;
			}
		} else {
			for(var i = 0; i < propo.length; i++) {
				if(propo[i].checked == true){
					if( propo[i].value=="oui") {
						propo[i].parentElement.setAttribute("class", "checkbox icheck-success");
						propo[i].parentElement.append(" Bonne réponse");
					}else{
						propo[i].parentElement.setAttribute("class", "checkbox icheck-danger");
						propo[i].parentElement.append(" Mauvaise réponse");
					}
					question[questionCourante].propositions[propo[i].id].checked = "oui";
				}else{
					question[questionCourante].propositions[propo[i].id].checked = "non";
				}
				propo[i].disabled = true;
			}
		}
		var found = $.inArray(numeroQuestionCourante, listeQuestionsFaites);
		if(found==-1){
			$("#ulQuestion"+numeroQuestionCourante).append("<i class='fa fa-pencil' aria-hidden='true'></i>");
			listeQuestionsFaites.push(numeroQuestionCourante);
		}
		this.disabled = true;
		var ButtonModifier = document.getElementById("edit");
		ButtonModifier.disabled = false;
	});

	var ButtonModifier = document.getElementById("edit");
	ButtonModifier.addEventListener ("click", function() {
		var propo = document.getElementsByName("propo");
		var ButtonVerifier = document.getElementById("check");
		ButtonVerifier.disabled = false;
		var propo = document.getElementsByName("propo");
		for(var i = 0; i < propo.length; i++) {
			propo[i].disabled = false;
		}
		this.disabled = true;
	});

	$("#ulQuestion li").click(function(){
		var val = this.value;
		// on passe à la question courante
		$("#enonce").empty();
		$("#proposition").empty();
		numeroQuestionCourante = val;
		questionCourante = "question"+numeroQuestionCourante;

		exerciceSuivant(questionCourante);
		MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
		return false;
	});

});

function exerciceSuivant(courant){

	$("#enonce").text(question[courant].enonce);
	var radio_home = document.getElementById("proposition");
	var found = $.inArray(numeroQuestionCourante, listeQuestionsFaites);
	var ButtonVerifier = document.getElementById("check");
	var ButtonModifier = document.getElementById("edit");
	if(found==-1){
		if(question[courant].choixMultiple == "non"){
			for(key in question[courant].propositions){
				if(question[courant].propositions[key].checked=="oui"){
					$("#proposition").append("<div class='radio icheck-primary' id ='class'"+key+"'> <input type='radio' id='"+key+"' name='propo' value ='"+question[courant].propositions[key].solution+"' checked/> <label for='"+key+"'>"+question[courant].propositions[key].enonce+"</label></div>");				
				}else{
					$("#proposition").append("<div class='radio icheck-primary' id ='class'"+key+"'> <input type='radio' id='"+key+"' name='propo' value ='"+question[courant].propositions[key].solution+"'/> <label for='"+key+"'>"+question[courant].propositions[key].enonce+"</label></div>");			
				}}
		} else {
			for(key in question[courant].propositions){
				if(question[courant].propositions[key].checked=="oui"){
					$("#proposition").append("<div class='checkbox icheck-primary' id ='class'"+key+"'> <input type='checkbox' id='"+key+"' name='propo' value ='"+question[courant].propositions[key].solution+"' checked/> <label for='"+key+"'>"+question[courant].propositions[key].enonce+"</label></div>");				
				}else{
					$("#proposition").append("<div class='checkbox icheck-primary' id ='class'"+key+"'> <input type='checkbox' id='"+key+"' name='propo' value ='"+question[courant].propositions[key].solution+"'/> <label for='"+key+"'>"+question[courant].propositions[key].enonce+"</label></div>");			
				}
			}
		}
		ButtonVerifier.disabled = false;
		ButtonModifier.disabled = true;
	}else{
		if(question[courant].choixMultiple == "non"){
			for(key in question[courant].propositions){
				if(question[courant].propositions[key].checked=="oui"){
					$("#proposition").append("<div class='radio icheck-primary' id ='class'"+key+"'> <input type='radio' id='"+key+"' name='propo' value ='"+question[courant].propositions[key].solution+"' checked disabled/> <label for='"+key+"'>"+question[courant].propositions[key].enonce+"</label></div>");				
				}else{
					$("#proposition").append("<div class='radio icheck-primary' id ='class'"+key+"'> <input type='radio' id='"+key+"' name='propo' value ='"+question[courant].propositions[key].solution+"'disabled/> <label for='"+key+"'>"+question[courant].propositions[key].enonce+"</label></div>");			
				}}
		} else {
			for(key in question[courant].propositions){
				if(question[courant].propositions[key].checked=="oui"){
					$("#proposition").append("<div class='checkbox icheck-primary' id ='class'"+key+"'> <input type='checkbox' id='"+key+"' name='propo' value ='"+question[courant].propositions[key].solution+"' checked disabled/> <label for='"+key+"'>"+question[courant].propositions[key].enonce+"</label></div>");				
				}else{
					$("#proposition").append("<div class='checkbox icheck-primary' id ='class'"+key+"'> <input type='checkbox' id='"+key+"' name='propo' value ='"+question[courant].propositions[key].solution+"'disabled/> <label for='"+key+"'>"+question[courant].propositions[key].enonce+"</label></div>");			
				}
			}
		}
		ButtonVerifier.disabled = true;
		ButtonModifier.disabled = false;
	}
	if(finQcm==true){
		$("#bodyQuestion *").attr("disabled", "disabled").off('click');
	}
}


var totaltime = 60;
function update(percent){
	var deg;
	if(percent<(totaltime/2)){
		deg = 90 + (360*percent/totaltime);
		$('.pie').css('background-image',
				'linear-gradient('+deg+'deg, transparent 50%, white 50%),linear-gradient(90deg, white 50%, transparent 50%)'
		);
	} else if(percent>=(totaltime/2)){
		deg = -90 + (360*percent/totaltime);
		$('.pie').css('background-image',
				'linear-gradient('+deg+'deg, transparent 50%, red 50%),linear-gradient(90deg, white 50%, transparent 50%)'
		);
	}
}

var timer = new Timer();
timer.start({precision: 'seconds', startValues: {seconds: 0}, target: {seconds: 30}});
$('#values').html(timer.getTimeValues().toString());
timer.addEventListener('secondsUpdated', function (e) {
	$('#values').html(timer.getTimeValues().minutes+":"+timer.getTimeValues().seconds);
	var count = timer.getTotalTimeValues().seconds;
	update(count);
});
timer.addEventListener('targetAchieved', function (e) {
	$("#bodyQuestion *").attr("disabled", "disabled").off('click');
	finQcm = true;
});
